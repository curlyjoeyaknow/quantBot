---
description: Testing rules for tests/ directory
globs: ["tests/**/*.ts", "**/*.test.ts", "**/*.spec.ts"]
alwaysApply: true
---

# Testing Rules (tests/)

test-organization:

directory-structure:
    - "`tests/unit/` contains unit tests for individual functions and classes."
    - "`tests/integration/` contains integration tests for interactions between components."
    - "`tests/__mocks__/` contains reusable mock implementations for testing."

test-file-naming:
    - "Unit test files must be named with `.test.ts` or `.spec.ts` suffix."
    - "Co-locate test files with source files when appropriate."
    - "Use descriptive file names that indicate the unit under test."

test-file-naming-conventions:
    - "Unit test files must use either the `.test.ts` or `.spec.ts` suffix (e.g., `calculate-pnl.test.ts`)."
    - "Test files should be co-located with their corresponding source files when appropriate."
    - "Use descriptive file names that clearly indicate the unit under test. Avoid generic filenames."

test-structure:
    - "Use AAA pattern (Arrange, Act, Assert) in all test cases."
    - "Prefer one assertion per test when possible."
    - "Use descriptive test names (e.g., should calculate PnL correctly when trade closes at profit)."
    - "Group related tests using `describe` blocks."
    - "Use `beforeEach` and `afterEach` hooks for setup and teardown logic."

test-coverage:
    - "Aim for 80%+ code coverage"
    - "Focus on business logic coverage"
    - "Test edge cases and error conditions"
    - "Test both success and failure paths"
    - "Don't test implementation details"

mocking:
    - "Mock external dependencies (APIs, databases, file system)"
    - "Use Jest mocks for functions and modules"
    - "Create reusable mock factories"
    - "Reset mocks between tests"
    - "Verify mock calls when appropriate"

async-testing:
    - "Use async/await in tests"
    - "Wait for async operations to complete"
    - "Test error handling in async code"
    - "Use proper timeout values"
    - "Clean up async resources"

test-data:
    - "Use factories for test data creation"
    - "Keep test data minimal and focused"
    - "Use realistic but simplified data"
    - "Avoid hardcoded values when possible"
    - "Clean up test data after tests"

assertions:
    - "Use descriptive assertion messages"
    - "Test one thing per assertion"
    - "Use appropriate matchers"
    - "Test both positive and negative cases"
    - "Verify error messages when testing errors"

performance:
    - "Keep tests fast (< 100ms per test)"
    - "Use parallel test execution"
    - "Avoid unnecessary setup/teardown"
    - "Mock slow operations"

integration-tests:
    - "Test real component interactions"
    - "Use test databases when needed"
    - "Clean up after integration tests"
    - "Test error scenarios"
    - "Verify side effects"

test-utilities:
    - "Create reusable test utilities"
    - "Use test helpers for common patterns"
    - "Create custom matchers when needed"
    - "Share test fixtures across tests"
    - "Document test utilities"

documentation:
    - "Document complex test scenarios"
    - "Explain why tests exist"
    - "Document test data requirements"
    - "Include examples in test descriptions"
    - "Keep test code readable"

