# Changelog Enforcement Rules

## CRITICAL: All Changes Must Be Logged

**MANDATORY**: Every code change that affects functionality, security, or behavior MUST be logged in `CHANGELOG.md`.

## When to Update CHANGELOG

### ALWAYS Update For:
- ✅ Security fixes (use `### Security` section)
- ✅ Bug fixes (use `### Fixed` section)
- ✅ New features (use `### Added` section)
- ✅ Breaking changes (use `### Changed` or `### Removed` section)
- ✅ Performance improvements
- ✅ Memory leak fixes
- ✅ Type safety improvements
- ✅ API changes
- ✅ Dependency updates that affect behavior

### Format Requirements

1. **Use Keep a Changelog format**:
   - `### Security` - Security vulnerability fixes
   - `### Fixed` - Bug fixes
   - `### Added` - New features
   - `### Changed` - Changes in existing functionality
   - `### Deprecated` - Soon-to-be removed features
   - `### Removed` - Removed features

2. **Severity Indicators**:
   - Use `**CRITICAL**`, `**HIGH**`, `**MEDIUM**` prefixes for security/bug fixes
   - Example: `**CRITICAL**: Fixed SQL injection vulnerability in ClickHouse queries`

3. **Location References**:
   - Include file/package location when relevant
   - Example: `Fixed memory leak in EventBus (packages/utils/src/events/EventBus.ts)`

4. **Date Format**:
   - Use `YYYY-MM-DD` format for version dates
   - Example: `## [1.0.4] - 2025-01-13`

## Pre-Commit Checklist

Before committing, verify:
- [ ] CHANGELOG.md updated with all changes
- [ ] Changes categorized correctly (Security/Fixed/Added/Changed/Removed)
- [ ] Severity indicators added for security/bug fixes
- [ ] Location references included where relevant

## Enforcement

- **Pre-commit hook**: Should check for CHANGELOG updates (if implemented)
- **Code review**: Reject PRs without CHANGELOG updates
- **AI Assistant**: Always remind to update CHANGELOG when making changes

## Examples

### Good Example:
```markdown
### Security

- **CRITICAL**: Fixed SQL injection vulnerability in ClickHouse queries - now uses parameterized queries with `{param:Type}` syntax

### Fixed

- **CRITICAL**: Fixed EventBus memory leak - event history now optional, periodic cleanup implemented
```

### Bad Example (Missing):
- Making a security fix without updating CHANGELOG
- Adding a feature without logging it
- Fixing a bug without documenting it

## Special Cases

### Multiple Changes in One PR
- Group related changes together
- Use bullet points for clarity
- Maintain chronological order (newest first in `[Unreleased]`)

### Breaking Changes
- Must be clearly marked
- Include migration instructions if needed
- Move to versioned section when released

## Version Release

When releasing a version:
1. Move `[Unreleased]` items to versioned section
2. Add release date
3. Create new `[Unreleased]` section
4. Tag commit with version number
