<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Lab UI — Equity Curve</title>
  <link rel="stylesheet" href="/public/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <nav>
    <a href="/strategies">Strategies</a>
    <a href="/runs">Runs</a>
    <a href="/leaderboard">Leaderboard</a>
    <a href="/truth">Truth</a>
    <a href="/policies">Policies</a>
    <a href="/optimize">Optimize</a>
  </nav>

  <main>
    <div class="row" style="align-items: center; margin-bottom: 1rem;">
      <h1>Equity Curve</h1>
      <button onclick="window.location.href='/runs'" style="margin-left: auto;">← Back</button>
    </div>

    <section class="card">
      <h2>Configuration</h2>
      <div class="grid">
        <label>Run ID<br/>
          <input id="runId" placeholder="run_xyz123" />
        </label>
        <label>Initial Capital (USD)<br/>
          <input type="number" id="initialCapital" value="10000" min="100" step="100" />
        </label>
      </div>
      <div class="grid">
        <label>Position Sizing<br/>
          <select id="positionSizingMode">
            <option value="fixed">Fixed USD</option>
            <option value="percent">Percent of Equity</option>
          </select>
        </label>
        <label>Position Size<br/>
          <input type="number" id="positionSizeValue" value="1000" min="1" step="100" />
        </label>
      </div>
      <div class="row">
        <button id="load" class="btn-primary">Load Equity Curve</button>
        <span id="msg"></span>
      </div>
    </section>

    <section class="card">
      <h2>Portfolio Metrics</h2>
      <div id="metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div class="metric-card">
          <div class="metric-label">Final Capital</div>
          <div class="metric-value" id="finalCapital">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Total PnL</div>
          <div class="metric-value" id="totalPnl">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">PnL %</div>
          <div class="metric-value" id="pnlPercent">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Max Drawdown</div>
          <div class="metric-value" id="maxDrawdown">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Sharpe Ratio</div>
          <div class="metric-value" id="sharpeRatio">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Win Rate</div>
          <div class="metric-value" id="winRate">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Total Trades</div>
          <div class="metric-value" id="totalTrades">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">W/L Ratio</div>
          <div class="metric-value" id="wlRatio">-</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Equity Curve</h2>
      <div style="position: relative; height: 400px;">
        <canvas id="equityChart"></canvas>
      </div>
    </section>

    <section class="card">
      <h2>Drawdown Chart</h2>
      <div style="position: relative; height: 300px;">
        <canvas id="drawdownChart"></canvas>
      </div>
    </section>

    <section class="card">
      <h2>Drawdown Periods</h2>
      <div class="table-scroll">
        <table id="tblDrawdowns">
          <thead>
            <tr>
              <th>Start</th>
              <th>End</th>
              <th>Duration</th>
              <th>Drawdown %</th>
              <th>Recovery</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="/public/equity.js"></script>
</body>
</html>

