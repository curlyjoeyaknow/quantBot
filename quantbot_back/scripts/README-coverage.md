# Coverage JSON Generation

## Automatic Generation

Coverage JSON is automatically generated when running tests with coverage:

```bash
# Generate coverage JSON (runs tests if needed)
pnpm coverage:generate

# Generate and store coverage snapshot
pnpm coverage:generate:store
```

## Manual Generation

The coverage JSON file (`coverage/coverage-summary.json`) is automatically created by Vitest when you run:

```bash
pnpm test:coverage
# or
pnpm test:cov
```

Vitest is configured to output `json-summary` format in addition to text, lcov, and HTML reports.

## Script Details

The `scripts/generate-coverage-json.ts` script:

1. **Checks** if `coverage/coverage-summary.json` exists
2. **Runs tests** with coverage if the file is missing
3. **Validates** the JSON structure
4. **Optionally stores** the snapshot (with `--store` flag)
5. **Optionally prints** a summary (with `--print` flag)

## Usage Examples

```bash
# Just ensure coverage JSON exists (runs tests if needed)
pnpm coverage:generate

# Generate and store in cache
pnpm coverage:generate:store

# Generate, validate, and print summary
tsx scripts/generate-coverage-json.ts --print

# Full workflow: generate, store, and print
tsx scripts/generate-coverage-json.ts --store --print
```

## CI Integration

In CI pipelines, you can use:

```bash
# Generate coverage JSON for CI
pnpm test:coverage

# The JSON will be at coverage/coverage-summary.json
```

The JSON file is automatically generated by Vitest's `json-summary` reporter.

## File Locations

- **Coverage JSON**: `coverage/coverage-summary.json` (Istanbul format)
- **Coverage HTML**: `coverage/index.html`
- **Coverage LCOV**: `coverage/lcov.info`
- **Stored Snapshots**: `~/.cache/quantbot/coverage/` (when using `--store`)

