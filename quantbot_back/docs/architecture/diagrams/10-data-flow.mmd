---
title: Data Flow - Input to Output
description: Complete data flow from input validation through processing to output formatting and artifact generation
---

# Data Flow - Input to Output

## Overview

This diagram shows the complete data flow from user input through validation, processing, storage operations, to result formatting and artifact generation.

## Key Concepts

- **Input Validation**: Zod schemas validate all inputs
- **Error Collection**: Collect errors vs fail-fast modes
- **Artifact Generation**: Run manifests, CSV exports
- **JSON-Serializable**: All results must be serializable

## Diagram

```mermaid
flowchart TD
    start[User Input<br/>CLI args or API request] --> normalize[Normalize Options<br/>Handle --flag value and --flag=value]
    normalize --> validate[Validate with Zod Schema<br/>Check types, required fields, ranges]
    
    validate -->|invalid| validationError[ValidationError<br/>User-friendly message]
    validationError --> endError[Display error<br/>process.exit 1]
    
    validate -->|valid| createContext[Create CommandContext<br/>Lazy service initialization]
    createContext --> callHandler[Call Handler<br/>handler validatedArgs, ctx]
    
    callHandler --> handlerProcess[Handler Processing<br/>Normalize types<br/>Get services from context<br/>Call workflows]
    
    handlerProcess --> workflow[Workflow Execution<br/>Validate spec<br/>Use WorkflowContext<br/>Process items]
    
    workflow --> errorPolicy{Error Mode?}
    errorPolicy -->|collect| collectErrors[Collect Errors<br/>Continue processing<br/>Return errors in result]
    errorPolicy -->|failFast| failFast[Fail Fast<br/>Throw on first error<br/>Stop processing]
    
    collectErrors --> serviceCalls[Service Calls<br/>Storage operations<br/>API calls via jobs]
    failFast --> serviceCalls
    
    serviceCalls -->|success| storeResults[Store Results<br/>DuckDB, ClickHouse]
    serviceCalls -->|error| handleError[Handle Error<br/>Based on error mode]
    
    handleError -->|collect mode| collectErrors
    handleError -->|failFast mode| throwError[Throw Error<br/>Bubble up]
    
    storeResults --> formatResult[Format Result<br/>JSON-serializable<br/>ISO strings for dates<br/>Plain objects]
    formatResult --> generateArtifacts[Generate Artifacts<br/>Run manifest<br/>CSV export<br/>NDJSON export]
    
    generateArtifacts --> formatOutput[Format Output<br/>Table, JSON, or CSV<br/>Based on --format flag]
    formatOutput --> display[Display Output<br/>Console or file]
    display --> end[Complete]
    
    throwError --> catchError[Catch in execute]
    catchError --> formatError[Format Error Message<br/>User-friendly]
    formatError --> endError
    
    style start fill:#e1f5ff
    style validate fill:#fff3cd
    style errorPolicy fill:#f8d7da
    style formatResult fill:#d4edda
    style generateArtifacts fill:#d1ecf1
    style end fill:#d4edda
    style endError fill:#f8d7da
```

## Error Collection vs Fail-Fast

```mermaid
graph TB
    subgraph collectMode[Collect Mode - Default]
        collectStart[Start processing items]
        collectLoop[For each item]
        collectTry[Try process item]
        collectCatch[Catch error]
        collectAdd[Add to errors array]
        collectContinue[Continue to next item]
        collectReturn[Return result with errors array]
    end

    subgraph failFastMode[Fail-Fast Mode]
        failStart[Start processing items]
        failLoop[For each item]
        failTry[Try process item]
        failCatch[Catch error]
        failThrow[Throw error immediately]
        failStop[Stop processing]
    end

    collectStart --> collectLoop
    collectLoop --> collectTry
    collectTry -->|error| collectCatch
    collectCatch --> collectAdd
    collectAdd --> collectContinue
    collectContinue --> collectLoop
    collectTry -->|success| collectContinue
    collectLoop -->|done| collectReturn

    failStart --> failLoop
    failLoop --> failTry
    failTry -->|error| failCatch
    failCatch --> failThrow
    failThrow --> failStop
    failTry -->|success| failLoop
```

## Related Documentation

- [ERROR_HANDLING.md](../ERROR_HANDLING.md)
- [WORKFLOW_ARCHITECTURE.md](../WORKFLOW_ARCHITECTURE.md)
- [CLI Architecture](../../packages/cli/docs/CLI_ARCHITECTURE.md)

