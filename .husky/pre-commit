#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running lightweight pre-commit checks..."

# 1. Auto-fix formatting (fast)
echo "ğŸ“ Auto-fixing formatting..."
npm run format

# 2. Auto-fix linting (fast)
echo "ğŸ” Auto-fixing linting..."
npm run lint:fix

# 3. Type check (fast)
echo "ğŸ” Type checking..."
npm run typecheck || {
  echo "âŒ Type check failed"
  exit 1
}

# 4. Verify workflow contracts (fast)
echo "ğŸ” Verifying workflow contracts..."
pnpm tsx scripts/verify-workflow-contract.ts || {
  echo "âŒ Workflow contract verification failed"
  exit 1
}

# 5. Verify dependency boundaries (fast)
echo "ğŸ” Verifying dependency boundaries..."
pnpm vitest packages/simulation/tests/architectural/import-rules.test.ts packages/ingestion/tests/unit/dependency-boundaries.test.ts packages/ohlcv/tests/unit/dependency-boundaries.test.ts --run || {
  echo "âŒ Dependency boundary checks failed"
  exit 1
}

echo "âœ… Pre-commit checks passed!"
echo "ğŸ’¡ Note: Full test suite runs in CI"

