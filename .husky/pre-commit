#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# 1. Format check
echo "ğŸ“ Checking formatting..."
npm run format:check || {
  echo "âŒ Formatting failed. Run: npm run format"
  exit 1
}

# 2. Lint check
echo "ğŸ” Linting..."
npm run lint:fix || {
  echo "âŒ Linting failed. Run: npm run lint:fix"
  exit 1
}

# 3. Type check
echo "ğŸ”· Type checking..."
npm run typecheck || {
  echo "âŒ Type check failed. Fix TypeScript errors."
  exit 1
}

# 4. Check test requirements based on changes
echo "ğŸ§ª Checking test requirements..."
npx ts-node scripts/git/check-test-requirements.ts || {
  echo "âŒ Test requirements not met. See above for details."
  exit 1
}

# 5. Run tests for changed files (if any)
echo "ğŸ§ª Running tests for changed files..."
npm test -- --related || {
  echo "âš ï¸  Some tests failed. Fix them before committing."
  exit 1
}

echo "âœ… All pre-commit checks passed!"
